#summary How to build MacVim
#labels Featured,Phase-Implementation

=Building !MacVim from the Git repository=

*NOTE:* This is the official way of building !MacVim.

==Summary==

If you know what you are doing, then this should be enough to get you going:
  * Clone the !MacVim.git repo: `git clone git://repo.or.cz/MacVim.git vim7`
  * Configure and build Vim: `cd vim7/src; ./configure --enable-gui=macvim; make`
  * Build !MacVim.app: `cd MacVim; xcodebuild`
  * Run: `open build/Release/MacVim.app`
Make sure you pass `--enable-gui=macvim` to `configure`, else everything will
build but no windows open when you run the application.



==Installing Git==

If you have !MacPorts then you can install Git by opening a Terminal window and
typing
{{{
localhost:~ user$ sudo port install git-core
}}}
(This might take a while.)


==Downloading and building==

Once you have Git installed you first have to clone the !MacVim.git repo
{{{
localhost:~ user$ git clone git://repo.or.cz/MacVim.git vim7
}}}
This will create a folder named `vim7` and populate it with all the source code
needed to build !MacVim (you can choose any name you want instead of `vim7`).

Next, you have to configure Vim to include the !MacVim specific code and build Vim
{{{
localhost:~ user$ cd vim7/src
localhost:~/vim7/src user$ ./configure --enable-gui=macvim --with-features=huge
localhost:~/vim7/src user$ make
}}}
Be very careful when typing that second line!  If you misspell the parameters to
configure then everything will compile but !MacVim won't open any windows when
you start it.  After `make` finishes you should have a binary named `Vim` in
the `vim7/src` folder.

The final step is to build the !MacVim application.
{{{
localhost:~/vim7/src user$ cd MacVim
localhost:~/vim7/src/MacVim user$ xcodebuild
}}}
That's it!  !MacVim.app is in the `build/Release` folder, try to run it by
typing
{{{
localhost:~/vim7/src/MacVim user$ open build/Release/MacVim.app
}}}


==Updating an existing Git repository==

If you already have the !MacVim.git repo then updating it is as easy as
{{{
localhost:~ user$ cd vim7
localhost:~/vim7 user$ git pull
}}}


==Contributing with patches==

Patches can be created using the git-format-patch command, for example
{{{
localhost:~/vim7 user$ git-format-patch origin/master
}}}
This will create a patch including all the differences between the
current branch and the latest master branch you pulled from the public repo.
{{{
localhost:~/vim7 user$ git-format-patch HEAD^
}}}
This will create a patch that contains all changes included in your last commit.

Once you have created a patch you should post it to the vim_mac mailing list,
either manually or by using git-send-email.



=Running several versions of !MacVim simultaneously=

If you have one version of !MacVim in e.g. `/Applications` and then build another with Xcode and try to run it, there will be trouble (since both are listening to the same named port for new Vim connections).  To get around this do the following (assuming you have installed !MacVim in the Applications folder):
  * Open a Finder window on `/Applications`
  * Rename `MacVim` to `MacVim-devel`
  * Ctrl-click on the `MacVim-devel` icon and choose 'Show Package Contents'
  * In the window that opens, double-click on `Contents` and then on `Info.plist`; this will bring up the 'Property List Editor'
  * Expand `Root`, change `CFBundleIdentifier` to `org.vim.MacVim-devel`; save and quit the 'Property List Editor'

You can now run !MacVim-devel whilst building and running !MacVim in Xcode.


=Building a universal binary=

By default only a native binary will be built.  To build a universal binary you must first pass `--with-mac-arch=both` to `configure` and then edit the build settings for _both_ `MacVim.xcodeproj` and `PSMTabBarControl.xcodeproj`.  This is how you change the build settings in Xcode:
  * Select `MacVim` under `Targets` in the left-hand column in Xcode, then press Cmd-I to open up the 'Info' window
  * Click the `Build` tab and locate the `Architectures` setting, double-click on it and select both `PowerPC` and `Intel`
  * Do the same for the PSMTabBarControlProject




=Building !MacVim from the Subversion repository=

*NOTE:* The subversion repository has been deprecated, please use Git to
download and build !MacVim.

==For the impatient==

Here is the summary on what you need to do:
  * Get the vim7 source
  * Check out the !MacVim source from the Google code repository and put it inside `vim7/src/MacVim`
  * Download the latest patch archive `macvim-r*-patch.tar.gz` from the 'Downloads' tab. The archive contains `macvim.diff`, `runtime/doc/gui_mac.txt`, `runtime/colors/macvim.vim` and `src/proto/gui_macvim.pro`. Unarchive in the `vim7/` folder and apply the patch `macvim.diff`.
  * Build Vim with `configure --enable-gui=macvim` and then `make`
  * Open `MacVim/MacVim.xcodeproj` and build it

If those instructions were not enough, then read on...


==The long version==

First get the Vim source code.  In order to do this, start Terminal and type
{{{
localhost:~ user$ svn co https://vim.svn.sourceforge.net/svnroot/vim/vim7
}}}
This will create the folder vim7 and populate it with the Vim source (be patient, it can take a while).

Next, you need to patch the Vim source and runtime files. Download `macvim-r*-patch.tar.gz` from the `Downloads` tab to the `~/vim7` folder. Then type
{{{
localhost:~ user$ cd vim7/
localhost:~/vim7 user$ tar xzf macvim-r*-patch.tar.gz
}}}
In this last step you must of course replace the star with the actual revision number of the patch you downloaded. Now you have extracted the patch `macvim.diff` and the supporting files `runtime/doc/gui_mac.txt`, `runtime/colors/macvim.vim` and `src/proto/gui_macvim.pro`. Apply the patch by typing
{{{
localhost:~/vim7 user$ patch -p0 -i macvim.diff
}}}

Next, check out the !MacVim source and put it in the `vim7/src/MacVim` folder as follows:
{{{
localhost:~/vim7 user$ cd src/
localhost:~/vim7/src user$ svn co http://macvim.googlecode.com/svn/trunk/ MacVim
}}}

Now, build Vim 
{{{
localhost:~/vim7/src user$ autoconf
localhost:~/vim7/src user$ ./configure --enable-gui=macvim
localhost:~/vim7/src user$ make
}}}
If there were no problems building you should now have an executable named `Vim` in the `vim7/src` folder.

Finally, open `MacVim.xcodeproj` (which is inside the `MacVim` folder), and click the 'Build' button (Cmd+B).  This will build the application bundle `MacVim.app` inside `build/Release` (or `build/Debug`, depending on which build configuration is active).

That's it!